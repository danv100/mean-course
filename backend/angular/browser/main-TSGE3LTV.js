import{A as Ft,B as Dt,D as H,F as jt,G as Nt,H as Rt,L as Vt,M as Ut,N as zt,O as Bt,P as Ht,Q as Gt,R as $t,S as qt,T as Kt,U as Wt,V as Xt,W as G,a as vt,b as q,c as _t,d as yt,e as Ct,f as Pt,g as xt,h as St,i as V,j as U,k as bt,l as T,m as It,n as g,o as I,p as z,q as Mt,r as wt,s as At,t as Et,u as B,v as Lt,w as Ot,x as Tt,y as k,z as kt}from"./chunk-7C4LLHGM.js";import{Ab as d,Bb as R,Cb as dt,D as et,Fa as rt,Fb as ut,Ha as N,Ka as p,La as f,Ma as st,Oa as at,Qa as mt,Sa as ct,Ta as pt,W as it,Z as y,_ as A,ab as _,ac as ft,ca as C,cb as l,da as ot,g as Y,ia as P,ic as ht,j as Z,ja as E,jc as L,la as nt,lb as a,lc as gt,mb as s,nb as h,o as J,p as Q,pb as M,qa as x,ra as S,rb as b,s as tt,sb as u,zb as lt}from"./chunk-J2EOURVG.js";var F=It.apiUrl+"/posts/",O=(()=>{let t=class t{constructor(e,i){this.http=e,this.router=i,this.posts=[],this.postsUpdated=new Z}getPosts(e,i){let r=`?pagesize=${e}&page=${i}`;this.http.get(F+r).pipe(tt(m=>({posts:m.posts.map(c=>({title:c.title,content:c.content,id:c._id,imagePath:c.imagePath,creator:c.creator})),maxPosts:m.maxPosts}))).subscribe(m=>{console.log(m),this.posts=m.posts,this.postsUpdated.next({posts:[...this.posts],postCount:m.maxPosts})})}getPostUpdateListener(){return this.postsUpdated.asObservable()}getPost(e){return this.http.get(F+e)}addPost(e,i,r){let m=new FormData;m.append("title",e),m.append("content",i),m.append("image",r,e),this.http.post(F,m).subscribe(c=>{this.router.navigate(["/"])})}updatePost(e,i,r,m){let c;typeof m=="object"?(c=new FormData,c.append("id",e),c.append("title",i),c.append("content",r),c.append("image",m,i)):c={id:e,title:i,content:r,imagePath:m,creator:null},this.http.put(F+e,c).subscribe(w=>{this.router.navigate(["/"])})}deletePost(e){return this.http.delete(F+e)}};t.\u0275fac=function(i){return new(i||t)(C(vt),C(V))},t.\u0275prov=y({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var pe=o=>["/edit",o];function le(o,t){o&1&&h(0,"mat-spinner")}function de(o,t){if(o&1){let n=M();a(0,"mat-action-row")(1,"a",8),d(2,"EDIT"),s(),a(3,"button",9),b("click",function(){x(n);let i=u().$implicit,r=u(2);return S(r.onDelete(i.id))}),d(4,"DELETE"),s()()}if(o&2){let n=u().$implicit;p(),l("routerLink",ut(1,pe,n.id))}}function ue(o,t){if(o&1&&(a(0,"mat-expansion-panel")(1,"mat-expansion-panel-header"),d(2),s(),a(3,"div",6),h(4,"img",7),s(),a(5,"p"),d(6),s(),_(7,de,5,3,"mat-action-row",0),s()),o&2){let n=t.$implicit,e=u(2);p(2),dt(" ",n.title," "),p(2),l("src",n.imagePath,N)("alt",n.title),p(2),R(n.content),p(),l("ngIf",e.userIsAuthenticated&&e.userId==n.creator)}}function fe(o,t){if(o&1&&(a(0,"mat-accordion",4),_(1,ue,8,5,"mat-expansion-panel",5),s()),o&2){let n=u();p(),l("ngForOf",n.posts)}}function he(o,t){if(o&1){let n=M();a(0,"mat-paginator",10),b("page",function(i){x(n);let r=u();return S(r.onChangedPage(i))}),s()}if(o&2){let n=u();l("length",n.totalPosts)("pageSize",n.postsPerPage)("pageSizeOptions",n.pageSizeOptions)}}function ge(o,t){o&1&&(a(0,"p",11),d(1,"No posts added yet."),s())}var Jt=(()=>{let t=class t{constructor(e,i){this.postsService=e,this.authService=i,this.posts=[],this.isLoading=!1,this.totalPosts=0,this.postsPerPage=2,this.currentPage=1,this.pageSizeOptions=[1,2,5,10],this.userIsAuthenticated=!1}ngOnInit(){this.isLoading=!0,this.postsService.getPosts(this.postsPerPage,this.currentPage),this.userId=this.authService.getUserId(),this.postsSub=this.postsService.getPostUpdateListener().subscribe(e=>{this.isLoading=!1,this.totalPosts=e.postCount,this.posts=e.posts}),this.userIsAuthenticated=this.authService.getIsAuth(),this.authStatusSub=this.authService.getAuthStatusListener().subscribe(e=>{this.userIsAuthenticated=e,this.userId=this.authService.getUserId()})}onChangedPage(e){this.isLoading=!0,this.currentPage=e.pageIndex+1,this.postsPerPage=e.pageSize,this.postsService.getPosts(this.postsPerPage,this.currentPage)}onDelete(e){this.isLoading=!0,this.postsService.deletePost(e).subscribe(()=>{this.postsService.getPosts(this.postsPerPage,this.currentPage)},()=>{this.isLoading=!1})}ngOnDestroy(){this.postsSub.unsubscribe(),this.authStatusSub.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(f(O),f(g))},t.\u0275cmp=P({type:t,selectors:[["app-post-list"]],decls:4,vars:4,consts:[[4,"ngIf"],["multi","true",4,"ngIf"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],["class","info-text mat-body-1",4,"ngIf"],["multi","true"],[4,"ngFor","ngForOf"],[1,"post-image"],[3,"src","alt"],["mat-button","","color","accent",3,"routerLink"],["mat-button","","color","warn",3,"click"],[3,"page","length","pageSize","pageSizeOptions"],[1,"info-text","mat-body-1"]],template:function(i,r){i&1&&_(0,le,1,0,"mat-spinner",0)(1,fe,2,1,"mat-accordion",1)(2,he,1,3,"mat-paginator",2)(3,ge,2,0,"p",3),i&2&&(l("ngIf",r.isLoading),p(),l("ngIf",r.posts.length>0&&!r.isLoading),p(),l("ngIf",r.posts.length>0),p(),l("ngIf",r.posts.length<=0&&!r.isLoading))},dependencies:[ht,L,z,I,Et,Mt,wt,At,B,Ut,U],styles:["[_nghost-%COMP%]{display:block;margin-top:1rem}.info-text[_ngcontent-%COMP%]{text-align:center}mat-spinner[_ngcontent-%COMP%]{margin:auto}mat-paginator[_ngcontent-%COMP%]{margin-top:1rem}.post-image[_ngcontent-%COMP%]{width:100%}.post-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;box-shadow:1px 1px 5px #00000080}"]});let o=t;return o})();var Qt=o=>{if(typeof o.value=="string")return J(null);let t=o.value,n=new FileReader;return Y.create(i=>{n.addEventListener("loadend",()=>{let r=new Uint8Array(n.result).subarray(0,4),m="",c=!1;for(let w=0;w<r.length;w++)m+=r[w].toString(16);switch(m){case"89504e47":c=!0;break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":c=!0;break;default:c=!1;break}c?i.next(null):i.next({invalidMimeType:!0}),i.complete()}),n.readAsArrayBuffer(t)})};function ve(o,t){o&1&&h(0,"mat-spinner")}function _e(o,t){o&1&&(a(0,"mat-error"),d(1,"Please enter a post title."),s())}function ye(o,t){if(o&1&&(a(0,"div",11),h(1,"img",12),s()),o&2){let n=u(2);p(),l("src",n.imagePreview,N)("alt",n.form.value.title)}}function Ce(o,t){o&1&&(a(0,"mat-error"),d(1,"Please enter post content."),s())}function Pe(o,t){if(o&1){let n=M();a(0,"form",4),b("submit",function(){x(n);let i=u();return S(i.onSavePost())}),a(1,"mat-form-field"),h(2,"input",5),_(3,_e,2,0,"mat-error",2),s(),a(4,"div")(5,"button",6),b("click",function(){x(n);let i=lt(8);return S(i.click())}),d(6,"Pick Image"),s(),a(7,"input",7,0),b("change",function(i){x(n);let r=u();return S(r.onImagePicked(i))}),s()(),_(9,ye,2,2,"div",8),a(10,"mat-form-field")(11,"textarea",9),d(12,"      "),s(),_(13,Ce,2,0,"mat-error",2),s(),a(14,"button",10),d(15," Save Post "),s()()}if(o&2){let n=u();l("formGroup",n.form),p(3),l("ngIf",n.form.get("title").invalid),p(6),l("ngIf",n.imagePreview!==""&&n.imagePreview&&n.form.get("image").valid),p(4),l("ngIf",n.form.get("content").invalid)}}var W=(()=>{let t=class t{constructor(e,i,r){this.postsService=e,this.route=i,this.authService=r,this.enteredContent="",this.enteredTitle="",this.isLoading=!1,this.mode="create"}ngOnInit(){this.authStatusSub=this.authService.getAuthStatusListener().subscribe(e=>{this.isLoading=!1}),this.form=new Dt({title:new H(null,{validators:[k.required,k.minLength(3)]}),content:new H(null,{validators:[k.required]}),image:new H(null,{validators:[k.required],asyncValidators:[Qt]})}),this.route.paramMap.subscribe(e=>{e.has("postId")?(this.mode="edit",this.postId=e.get("postId"),this.isLoading=!0,this.postsService.getPost(this.postId).subscribe(i=>{this.isLoading=!1,this.post={id:i._id,title:i.title,content:i.content,imagePath:i.imagePath,creator:i.creator},this.form.setValue({title:this.post.title,content:this.post.content,image:this.post.imagePath})})):(this.mode="create",this.postId=null)})}onImagePicked(e){let i=e.target.files[0];this.form.patchValue({image:i}),this.form.get("image").updateValueAndValidity();let r=new FileReader;r.onload=()=>{this.imagePreview=r.result},r.readAsDataURL(i)}onSavePost(){this.form.invalid||(this.isLoading=!0,this.mode=="create"?this.postsService.addPost(this.form.value.title,this.form.value.content,this.form.value.image):this.postsService.updatePost(this.postId,this.form.value.title,this.form.value.content,this.form.value.image),this.form.reset())}ngOnDestroy(){this.authStatusSub.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(f(O),f(xt),f(g))},t.\u0275cmp=P({type:t,selectors:[["app-post-create"]],decls:3,vars:2,consts:[["filePicker",""],["color","primary"],[4,"ngIf"],[3,"formGroup","submit",4,"ngIf"],[3,"submit","formGroup"],["matInput","","type","text","formControlName","title","placeholder","Post Title"],["mat-stroked-button","","type","button","color","secondary",3,"click"],["type","file",3,"change"],["class","image-preview",4,"ngIf"],["matInput","","rows","4","formControlName","content","placeholder","Post Content"],["mat-raised-button","","color","accent","type","submit"],[1,"image-preview"],[3,"src","alt"]],template:function(i,r){i&1&&(a(0,"mat-card",1),_(1,ve,1,0,"mat-spinner",2)(2,Pe,16,4,"form",3),s()),i&2&&(p(),l("ngIf",r.isLoading),p(),l("ngIf",!r.isLoading))},dependencies:[L,jt,Tt,kt,Ft,Nt,Rt,zt,Ot,Lt,Bt,I,B],styles:["mat-card[_ngcontent-%COMP%]{padding:1rem}mat-form-field[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin:auto}input[type=file][_ngcontent-%COMP%]{visibility:hidden}.image-preview[_ngcontent-%COMP%]{height:5rem;margin:1rem 0}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}"]});let o=t;return o})();var $=(()=>{let t=class t{constructor(e,i){this.authService=e,this.router=i}canActivate(e,i){let r=this.authService.getIsAuth();return r||this.router.navigate(["/auth/login"]),r}};t.\u0275fac=function(i){return new(i||t)(C(g),C(V))},t.\u0275prov=y({token:t,factory:t.\u0275fac});let o=t;return o})();var xe=[{path:"",component:Jt},{path:"create",component:W,canActivate:[$]},{path:"edit/:postId",component:W,canActivate:[$]},{path:"auth",loadChildren:()=>import("./chunk-YI3C72EL.js").then(o=>o.AuthModule)}],te=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=E({type:t}),t.\u0275inj=A({providers:[$],imports:[T.forRoot(xe),T]});let o=t;return o})();function Se(o,t){o&1&&(a(0,"li")(1,"a",4),d(2,"New Post"),s()())}function be(o,t){o&1&&(a(0,"li")(1,"a",5),d(2,"Login"),s()())}function Ie(o,t){o&1&&(a(0,"li")(1,"a",6),d(2,"Signup"),s()())}function Me(o,t){if(o&1){let n=M();a(0,"li")(1,"button",7),b("click",function(){x(n);let i=u();return S(i.onLogout())}),d(2,"Logout"),s()()}}var ee=(()=>{let t=class t{constructor(e){this.authService=e,this.userIsAuthenticated=!1}ngOnInit(){this.userIsAuthenticated=this.authService.getIsAuth(),this.authListenerSubs=this.authService.getAuthStatusListener().subscribe(e=>{this.userIsAuthenticated=e})}onLogout(){this.authService.logout()}ngOnDestroy(){this.authListenerSubs.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(f(g))},t.\u0275cmp=P({type:t,selectors:[["app-header"]],decls:10,vars:4,consts:[["color","primary"],["routerLink","/"],[1,"spacer"],[4,"ngIf"],["mat-button","","routerLink","/create","routerLinkActive","mat-accent"],["mat-button","","routerLink","/auth/login","routerLinkActive","mat-accent"],["mat-button","","routerLink","/auth/signup","routerLinkActive","mat-accent"],["mat-button","",3,"click"]],template:function(i,r){i&1&&(a(0,"mat-toolbar",0)(1,"span")(2,"a",1),d(3,"MyMessages"),s()(),h(4,"span",2),a(5,"ul"),_(6,Se,3,0,"li",3)(7,be,3,0,"li",3)(8,Ie,3,0,"li",3)(9,Me,3,0,"li",3),s()()),i&2&&(p(6),l("ngIf",r.userIsAuthenticated),p(),l("ngIf",!r.userIsAuthenticated),p(),l("ngIf",!r.userIsAuthenticated),p(),l("ngIf",r.userIsAuthenticated))},dependencies:[L,U,bt,z,I,Ht],styles:["ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}a[_ngcontent-%COMP%]{text-decoration:none;color:#fff}ul[_ngcontent-%COMP%]{display:flex}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]});let o=t;return o})();var ie=(()=>{let t=class t{constructor(e){this.authService=e}ngOnInit(){this.authService.autoAuthUser()}};t.\u0275fac=function(i){return new(i||t)(f(g))},t.\u0275cmp=P({type:t,selectors:[["app-root"]],decls:3,vars:0,template:function(i,r){i&1&&(h(0,"app-header"),a(1,"main"),h(2,"router-outlet"),s())},dependencies:[St,ee],styles:["main[_ngcontent-%COMP%]{width:80%;margin:1rem auto}"]});let o=t;return o})();var Ae="@",Ee=(()=>{let t=class t{constructor(e,i,r,m,c){this.doc=e,this.delegate=i,this.zone=r,this.animationType=m,this.moduleImpl=c,this._rendererFactoryPromise=null,this.scheduler=ot(at,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-HNB5VLJN.js")).catch(i=>{throw new it(5300,!1)}).then(({\u0275createEngine:i,\u0275AnimationRendererFactory:r})=>{this._engine=i(this.animationType,this.doc,this.scheduler);let m=new r(this.delegate,this._engine,this.zone);return this.delegate=m,m})}createRenderer(e,i){let r=this.delegate.createRenderer(e,i);if(r.\u0275type===0)return r;typeof r.throwOnSyntheticProps=="boolean"&&(r.throwOnSyntheticProps=!1);let m=new X(r);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(c=>{let w=c.createRenderer(e,i);m.use(w)}).catch(c=>{m.use(r)}),m}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};t.\u0275fac=function(i){st()},t.\u0275prov=y({token:t,factory:t.\u0275fac});let o=t;return o})(),X=class{constructor(t){this.delegate=t,this.replay=[],this.\u0275type=1}use(t){if(this.delegate=t,this.replay!==null){for(let n of this.replay)n(t);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(t,n){return this.delegate.createElement(t,n)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}get destroyNode(){return this.delegate.destroyNode}appendChild(t,n){this.delegate.appendChild(t,n)}insertBefore(t,n,e,i){this.delegate.insertBefore(t,n,e,i)}removeChild(t,n,e){this.delegate.removeChild(t,n,e)}selectRootElement(t,n){return this.delegate.selectRootElement(t,n)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,n,e,i){this.delegate.setAttribute(t,n,e,i)}removeAttribute(t,n,e){this.delegate.removeAttribute(t,n,e)}addClass(t,n){this.delegate.addClass(t,n)}removeClass(t,n){this.delegate.removeClass(t,n)}setStyle(t,n,e,i){this.delegate.setStyle(t,n,e,i)}removeStyle(t,n,e){this.delegate.removeStyle(t,n,e)}setProperty(t,n,e){this.shouldReplay(n)&&this.replay.push(i=>i.setProperty(t,n,e)),this.delegate.setProperty(t,n,e)}setValue(t,n){this.delegate.setValue(t,n)}listen(t,n,e){return this.shouldReplay(n)&&this.replay.push(i=>i.listen(t,n,e)),this.delegate.listen(t,n,e)}shouldReplay(t){return this.replay!==null&&t.startsWith(Ae)}};function oe(o="animations"){return ct("NgAsyncAnimations"),nt([{provide:mt,useFactory:(t,n,e)=>new Ee(t,n,e,o),deps:[ft,yt,pt]},{provide:rt,useValue:o==="noop"?"NoopAnimations":"BrowserAnimations"}])}var ne=(()=>{let t=class t{constructor(e){this.authService=e}intercept(e,i){let r=this.authService.getToken(),m=e.clone({headers:e.headers.set("Authorization","Bearer "+r)});return i.handle(m)}};t.\u0275fac=function(i){return new(i||t)(C(g))},t.\u0275prov=y({token:t,factory:t.\u0275fac});let o=t;return o})();var re=(()=>{let t=class t{constructor(e){this.data=e}};t.\u0275fac=function(i){return new(i||t)(f(Gt))},t.\u0275cmp=P({type:t,selectors:[["ng-component"]],decls:8,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"mat-body-1"],["mat-dialog-actions",""],["mat-button","","mat-dialog-close",""]],template:function(i,r){i&1&&(a(0,"h1",0),d(1,"An Error Occured!"),s(),a(2,"div",1)(3,"p",2),d(4),s()(),a(5,"div",3)(6,"button",4),d(7,"Okay"),s()()),i&2&&(p(4),R(r.data.message))},dependencies:[I,qt,Kt,Xt,Wt]});let o=t;return o})();var se=(()=>{let t=class t{constructor(e){this.dialog=e}intercept(e,i){return i.handle(e).pipe(et(r=>{let m="An unknown error occurred!!";return r.error.message&&(m=r.error.message),this.dialog.open(re,{data:{message:m}}),Q(r)}))}};t.\u0275fac=function(i){return new(i||t)(C($t))},t.\u0275prov=y({token:t,factory:t.\u0275fac});let o=t;return o})();var ae=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=E({type:t}),t.\u0275inj=A({imports:[gt,Vt,G,T]});let o=t;return o})();var me=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=E({type:t,bootstrap:[ie]}),t.\u0275inj=A({providers:[{provide:q,useClass:ne,multi:!0},{provide:q,useClass:se,multi:!0},oe(),O],imports:[Pt,te,G,_t,ae]});let o=t;return o})();Ct().bootstrapModule(me).catch(o=>console.error(o));
